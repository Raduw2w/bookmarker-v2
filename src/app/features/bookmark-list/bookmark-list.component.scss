/* Force mat-divider[inset] to stretch fully for horizontal list items */
.mat-divider.mat-divider-horizontal.mat-divider-inset,
mat-divider[inset].mat-divider-horizontal {
  box-sizing: border-box;
  margin-left: 0 !important;
  width: 100% !important;
}

/* =========================
   Base / tokens (SCSS)
   ========================= */
:host {
  display: block;
  /* helps sticky toolbar respect parent context */
  contain: content;
  font-family: 'Nunito', 'Roboto', Arial, sans-serif;
}

/* Design tokens */
$radius: 16px;
$radius-inner: 12px;
$easing: cubic-bezier(.2, .8, .2, 1);
$shadow: 0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(0,0,0,.08);
$shadow-hover: 0 2px 8px rgba(0,0,0,.06), 0 12px 28px rgba(0,0,0,.12);

/* --- Optional fallbacks when color-mix is unavailable --- */
$border-fallback: rgba(0, 0, 0, .10);
$hover-fallback: rgba(0, 0, 0, .06);
$primary-fallback: #6750A4;

/* =========================
   Card
   ========================= */
.bookmarks-card {
  display: block;
  padding: 1rem 1rem 1.25rem;
  border-radius: $radius;
  box-shadow: $shadow;
  position: relative;

  /* fallback first */
  border: 1px solid $border-fallback;
  background: #181818 !important;

  /* then upgrade when supported */
  @supports (color: color-mix(in oklab, black 0%, white 0%)) {
    border-color: color-mix(in oklab, currentColor 10%, transparent);
    background:
      var(--mat-card-background-color, var(--mdc-elevated-card-container-color, #fff)) padding-box,
      linear-gradient(180deg, color-mix(in oklab, currentColor 4%, transparent), transparent 32%) border-box;
  }

  mat-card-title {
    font-weight: 700;
    letter-spacing: .2px;
    margin-bottom: .1rem;
    display: inline-flex;
    align-items: center;
    gap: .5rem;
  }

  mat-card-subtitle {
    margin-bottom: .25rem;
    opacity: .75;
  }
}

/* =========================
   Progress Bar
   ========================= */
.bookmarks-progress-standalone {
  margin-bottom: 1rem;
  border-radius: $radius-inner;
  height: 4px;
  overflow: hidden;
  
  ::ng-deep .mdc-linear-progress__bar-inner {
    border-color: #1de9b6 !important;
  }
  
  ::ng-deep .mdc-linear-progress__buffer {
    background-color: rgba(29, 233, 182, 0.2) !important;
  }
}

.bookmarks-progress {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  border-radius: $radius $radius 0 0;
  z-index: 1000;
  height: 4px;
  
  ::ng-deep .mdc-linear-progress__bar-inner {
    border-color: #1de9b6 !important;
  }
  
  ::ng-deep .mdc-linear-progress__buffer {
    background-color: rgba(29, 233, 182, 0.2) !important;
  }
}

.state-loading {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 60vh;
  color: #9e9e9e;
  font-size: 1.2rem;
  flex-direction: column;
}

/* =========================
   Toolbar (row by default)
   Use .toolbar--stacked to switch to column layout
   ========================= */
.toolbar {
  position: sticky;
  top: 0; /* sits under app toolbar if any */
  z-index: 999;
  display: flex;                 /* FIX: was grid; flex works with props below */
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;               /* allows wrapping on small screens */
  gap: 12px;
  margin: .75rem 0 1rem;
  padding: .5rem;
  border-radius: $radius-inner;
  background-color: rgb(0, 0, 0);

  /* fallback first */
  border: 1px solid $border-fallback;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.5);
  backdrop-filter: saturate(140%) blur(6px);

  @supports (color: color-mix(in oklab, black 0%, white 0%)) {
    border-color: color-mix(in oklab, currentColor 10%, transparent);
  }

  /* Let search bar grow if it’s your component */
  app-search-bar { flex: 1 1 160px; min-width: 160px; } /* FIX: flex now applies */

  .new-btn {
    white-space: nowrap;
    display: inline-flex;
    gap: 6px;
    align-items: center;
    border-radius: 999px;
    text-transform: none;
    animation: pop-in .28s $easing both;
    transform-origin: center;

    &:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba($primary-fallback, .22); /* Sass color w/ alpha */

      @supports (color: color-mix(in oklab, black 0%, white 0%)) {
        box-shadow: 0 6px 18px color-mix(in oklab, var(--mat-primary, #6750A4) 22%, transparent);
      }
    }
  }

  /* Optional action row */
  .toolbar-actions {
    display: flex;
    align-items: center;
    gap: 8px;

    .new-btn { margin-left: auto; }
  }

  &.toolbar--stacked {
    flex-direction: column;      /* FIX: now affects a flex container */
    align-items: stretch;
    gap: 8px;
    margin: 8px 0 12px;
  }
}

/* =========================
   Groups
   ========================= */
.best-match-section {
  margin: .75rem 0 1.5rem;
  padding: 1rem;
  border-radius: $radius-inner;
  background: linear-gradient(135deg, rgba(29, 233, 182, 0.15), rgba(0, 191, 165, 0.10));
  border: 2px solid rgba(29, 233, 182, 0.4);
  box-shadow: 0 4px 12px rgba(29, 233, 182, 0.15);
  animation: best-match-glow .8s $easing both;

  .best-match-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: .75rem;

    .star-icon {
      color: #ffc107;
      font-size: 20px;
      height: 20px;
      width: 20px;
      animation: star-pulse 2s ease-in-out infinite;
    }

    h3 {
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.3px;
      margin: 0;
      color: #1de9b6;
    }
  }

  .best-match-list {
    padding: 0;

    .best-match-item {
      border-radius: $radius-inner - 2px;
      background: rgba(0, 0, 0, 0.2);

      &:hover {
        background: rgba(29, 233, 182, 0.2) !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }
    }
  }
}

.group {
  margin-top: 1.25rem;
  padding: .25rem 0;

  .group-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0 0 .5rem;
    padding: .25rem .25rem;
    border-radius: $radius-inner - 2px;
    animation: slide-fade-in .35s $easing both;

    h3 {
      font-size: .975rem;
      font-weight: 700;
      letter-spacing: .2px;
      margin: 0;
    }

    .caret {
      width: 36px;
      height: 36px;
      line-height: 36px;
    }

    mat-chip-set {
      --mdc-chip-container-height: 24px;
      margin-left: auto;

      mat-chip {
        font-size: .75rem;
        opacity: .9;
        border-radius: 999px;
        transform: translateZ(0); /* enable GPU */
        animation: chip-pop .26s $easing both;
      }
    }
  }
}

/* =========================
   Items
   ========================= */
.bookmark-item {
  width: 100%;
  display: flex;
  align-items: center;
  gap: .75rem; /* unified gap */
  padding: .375rem .25rem;
  position: relative;
  transition: background .18s $easing, transform .18s $easing, box-shadow .18s $easing;

  /* Custom hover color */
  &:hover {
    background: #046a5c7d !important; /* 8-digit hex w/ alpha */
    color: #fff !important;
  }

  &:active { transform: translateY(0.5px) scale(.998); }

  /* focus ring (baseline on focusables) */
  a:focus-visible,
  button:focus-visible {
    outline: 3px solid rgba($primary-fallback, .42);
    outline-offset: 2px;

    @supports (color: color-mix(in oklab, black 0%, white 0%)) {
      outline-color: color-mix(in oklab, var(--mat-primary, #6750A4) 42%, transparent);
    }
  }

  /* enhanced parent highlight where supported */
  @supports selector(:has(*)) {
    &:has(a:focus-visible, button:focus-visible) {
      outline: 3px solid rgba($primary-fallback, .42);
      outline-offset: 2px;

      @supports (color: color-mix(in oklab, black 0%, white 0%)) {
        outline-color: color-mix(in oklab, var(--mat-primary, #6750A4) 42%, transparent);
      }
    }
  }

  .bookmark-info {
    display: flex;
    flex-direction: column;
    min-width: 0; /* allow truncation */

    .title {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      line-height: 1.25;
      text-decoration: none;
      color: inherit;
      max-width: clamp(240px, 60vw, 720px);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: text-underline-offset .18s $easing;

      &:hover { text-decoration: underline; text-underline-offset: 2px; }
    }

    .url {
      font-size: 12px;
      opacity: .72;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: clamp(200px, 50vw, 560px);

      @media (max-width: 768px) { max-width: 240px; }
    }
  }

  .spacer { flex: 1 1 auto; }

  a[mat-button],
  button[mat-button] {
    border-radius: 999px;
    text-transform: none;
    height: 34px;
    line-height: 34px;

    mat-icon {
      font-size: 18px;
      height: 18px; width: 18px;
    }
  }

  /* subtle dividing line inside list */
  + mat-divider[inset] { margin-left: 16px; }
}

/* =========================
   List item container (Angular Material) — full fix for right-edge strip
   ========================= */

/* Host: remove host hover, clip ripple, share radius, provide var */
mat-list-item {
  cursor: pointer;
  background: none !important; /* kill any host background painting */
  border-radius: $radius-inner - 4px;
  overflow: hidden;            /* clip ripple + hover to radius */
  position: relative;

  --_hover-bg: #00000014;
  @supports (color: color-mix(in oklab, black 0%, white 0%)) {
    --_hover-bg: color-mix(in oklab, currentColor 8%, transparent);
  }
}

/* Inner MDC element: ensure full-bleed and radius */
mat-list-item .mat-mdc-list-item.mdc-list-item {
  border-radius: inherit;
  width: 100%;
  padding-inline: 8px; /* adjust if you need tighter/looser edges */
}

/* Paint the hover on the inner row so it covers 100% width */
mat-list-item .mat-mdc-list-item.mdc-list-item:hover {
  background: var(--_hover-bg);
}

/* Ripple tuning so hover overlay/ripple don’t leave artifacts */
mat-list-item .mat-mdc-list-item {
  --mdc-ripple-hover-opacity: 0;
  --mdc-ripple-press-opacity: 0.10;
}

/* Optional alternative: full-bleed pseudo overlay on host
   (uncomment if you prefer this approach instead of the inner :hover)
   Keeps the same radius/clip.
*/
/*
mat-list-item::before {
  content: '';
  position: absolute;
  inset: 0;
  background: transparent;
  pointer-events: none;
}
mat-list-item:hover::before {
  background: var(--_hover-bg);
}
*/

/* Divider spacing inside lists (unchanged) */
mat-list-item + mat-list-item mat-divider[inset] {
  margin-left: 0;
  width: 100%;
}

/* =========================
   Empty & Loading states
   ========================= */
.state {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
  padding: 1.25rem;
  color: rgba(0, 0, 0, .6);
  text-align: center;

  &.empty {
    flex-direction: column;
    gap: 8px;

    mat-icon {
      font-size: 40px;
      height: 40px; width: 40px;
      opacity: .6;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));
      animation: float 3s ease-in-out infinite;
    }

    p { margin: .25rem 0 0; }
  }

  &.loading {
    width: 100%;
    min-height: 72px;
    border-radius: $radius-inner;
    position: relative;
    overflow: hidden;

    /* fallback bg */
    background: $hover-fallback;

    @supports (color: color-mix(in oklab, black 0%, white 0%)) {
      background: color-mix(in oklab, currentColor 6%, transparent);
    }

    /* skeleton shimmer */
    &::before {
      content: '';
      position: absolute; inset: 0;
      transform: translateX(-100%);
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255,255,255,.7) 50%,
        transparent 100%
      );
      animation: shimmer 1.2s $easing infinite;
    }

    span { opacity: .001; } /* keep for a11y/DOM without showing text */
  }
}

/* =========================
   Animations
   ========================= */
@keyframes best-match-glow {
  from { 
    opacity: 0; 
    transform: translateY(-8px) scale(0.98);
  }
  to { 
    opacity: 1; 
    transform: translateY(0) scale(1);
  }
}

@keyframes star-pulse {
  0%, 100% { 
    transform: scale(1);
    filter: drop-shadow(0 0 2px rgba(255, 193, 7, 0.5));
  }
  50% { 
    transform: scale(1.15);
    filter: drop-shadow(0 0 6px rgba(255, 193, 7, 0.8));
  }
}

@keyframes slide-fade-in {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes chip-pop {
  from { transform: scale(.92); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}
@keyframes pop-in {
  0% { transform: scale(.98); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
@keyframes shimmer {
  100% { transform: translateX(100%); }
}
@keyframes float {
  0%,100% { transform: translateY(0); }
  50%     { transform: translateY(-4px); }
}

/* =========================
   Dark mode polish
   ========================= */
@media (prefers-color-scheme: dark) {
  .bookmarks-card {
    /* fallback */
    border-color: rgba(255,255,255,.22);
    background:
      var(--mat-card-background-color, #1b1b1b) padding-box,
      linear-gradient(180deg, rgba(255,255,255,.06), transparent 32%) border-box;

    @supports (color: color-mix(in oklab, black 0%, white 0%)) {
      border-color: color-mix(in oklab, currentColor 22%, transparent);
      background:
        var(--mat-card-background-color, #1b1b1b) padding-box,
        linear-gradient(180deg, color-mix(in oklab, currentColor 6%, transparent), transparent 32%) border-box;
    }
  }

  .toolbar {
    /* remove heavy tint; match card surface */
    border-color: rgba(255,255,255,.22);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    backdrop-filter: none;

    @supports (color: color-mix(in oklab, black 0%, white 0%)) {
      border-color: color-mix(in oklab, currentColor 22%, transparent);
    }
  }

  .state { color: rgba(255,255,255,.78); }
}

/* =========================
   Respect reduced motion
   (only here do we disable shimmer/animations)
   ========================= */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation: none !important; transition: none !important; }

  .state.loading {
    background: transparent;

    &::before { display: none; }
  }
}
